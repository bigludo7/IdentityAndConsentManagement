


# Purpose, API & open Gateway product granularity

## Objectives of this document

A lot of discussion around the concept of purpose and its management in CAMARA API occurred in particular in the Issue#32 (https://github.com/camaraproject/IdentityAndConsentManagement/issues/32).

We have, as of now, 2 distinct proposal on the table: one initially provided by Telefonica, and then a second proposed by the Orange team. Both proposal have a lot of common & agreed on the strong requirement for purpose & consent management. But as both proposal diverge on the Open Gateway product whom frame the API commercialization, the following table sum-up main points of both proposal in a form of a FAQ.

## Proposal presentation


| Id | Topic     | Telefonica proposal | Orange proposal |DT proposal |
| ---| --------- | ----------- | ---------  |----------- |
| 1 | What is the Open Gateway (OPGW) Product granularity? | Open Gateway Products are standardised including the required API/s and purpose. An OPGW product does not necessarily have to be just one API. It could be just one API operation and one scope, a whole API with multiple scopes (like QoD), it could be N APIs, or even individual API operations of different APIs. The Telefónica proposal is 100% flexible in this sense and removes this dependency with the product definition.<br>BUT if a product is finally defined as a single API, this would only be a simplification, and this is also in line with Telefónica's technical proposal. **The technical solution should not be tied to the current OpenGateway business model, as it could change in the future and because CAMARA APIs could be used outside the context of OpenGateway.** |  Open Gateway product matches 1-1 with a CAMARA API. For example, as of now, the CAMARA Device location API family features 2 APIs (2 yaml): `location-retrieval` and `location_verification` : we consider them as 2 separate OPGW product. The OPGW product covers completely the API (all the resources of the API). This is an important point because it means that API granularity must not be considered only from a technical aspect but also from a business aspect (which is already the case for CAMARA API). <br> The OPGW product is **not** strong-coupled with a purpose but independent of it. However in the catalog it is possible to recommend OPGW product with purpose (see next point).|Aligned with Orange regarding its documented OGW product example & interpretation. However DT's proposed solution has no tight coupling or dependancy on any specific product/business model and works for any Camara API based products even outside the context of OGW  |
| 2 | Do link between OPGW product and purpose is visible in Telco Catalog? | This is outside the scope of the technical discussion, but according to the playbook and what is agreed in the business track, there will be a hard link between product and purpose in the model (not quite between application and purpose). |  In the catalog, it could be possible to browse OPGW product per category. Several categories could be created, as such 'purpose' could be defined as a category, and purpose  value could be defined as category value (in order to get for example OPGW Product related to Fraud prevention & detection) but this is only informative information.  | Aligned with Orange  |
| 3 | What are country market required agreement before to launch?| The telco agreement for a given product to be launched should define what will be offered (CAMARA standard API/s) plus the purpose for which they will be used. This will define for a product its standardised OGW purpose as a combination of what will be the usage intention of the data (dpv_value) and what information (provided by APIs) will be accessed for that intention. Based on this agreement, the developer will be able to contract a product and the way to access the APIs enabled by that product will be the purpose (dpv_value + resource(s) used).  | Telco must agree on the OPGW product to be launched in the country as a minimum 'critical mass' must be available. Additionally Telco must indicate for each API scope the legal base associated with purposes for this country.| Not sure if this question is relevant for the purpose discussion |
| 4 | What is expected during Application onboarding?| This should not be relevant for the technical design of the purpose, what is relevant is that an application is associated with the product acquired by the developer, and given that a product is associated with a certain purpose (dpv_value + resource(s) used), the application is allowed to use it.  | When a developer wishes to uses CAMARA API, developer first onboards an application. Mandatory information to onboard an application is to provide the purpose (or the list of purposes) associated with this application. |Aligned with Orange regarding purpose selection at the time of Applicaton onboarding. Some other steps are also present here which are elaborated in the next row |
| 5 | What is expected during API onboarding?| We don't agree that the concept of API onboarding should be defined as such. Relevant information is provided in the previous row, developer does not onboard an application for a purpose (understood here as dpv_value only) and separately onboard APIs. Instead, the developer purchases a product, and that product defines the purpose (dpv_value + resource(s) used). We believe that these two things cannot be treated separately, the usage purpose (dpv_value) and the APIs, but together as the product's standardised purpose. <br>The developer contracts for a product that already has an associated purpose and the API/resources to which it provides access. | When a developer wishes to use a CAMARA API (prequisite developer has onboarded an app - previous point), it has to contractually agrees with the Hyperscaler/agregator/telco about Open Gateway product purchase. There is not tight coupling with purpose at this stage. Of course in the catalog the Telco could recommend some API for some purpose but API (and associated Open Gateway product) and purpose are not associated.  |We do not have this separate API onboarding stage. The agreement we want to have with the ASP is always for a specific App. We do not intend to have a generic agreement with an ASP which covers all his apps and our certain API product/s. In our agreement with the ASP we intend to have which ASP uses which API product(with agreed scopes) in which APP and for what purpose. So though API-product and purpose are not tightly coupled, the coupling is made at the time of app onboarding. |
| 6 | What is expected for each `/authorize` call? | <li>From a technical point of view, the standardised OGW purpose associated with the corresponding product is is a regular standard scope of the authorisation request.<li>Developer just needs to request the scope required for the OGW product to be accessed. It encapsulates all the necessary information for the Auth Server to apply the required access policy and logic (including the mapping to the technical scopes the product gives access to).<br><br>e.g.<br>scope=ogw:device-location:dpv:FraudPreventionAndDetection<br><br>or any other simplified format we may agree (exact format can be agreed later) such as:<br><br> FraudPreventionAndDetection:device-location<br>...<br><br>However, developers only need to request access to a single scope that represents an entire product, simplifying access management for developers. For example, for a QoD product, why would you need to provide the full list of QoD technical scopes and then validate that the list provided actually corresponds to the product? Instead, you can simply request access to the scope of product X and then eventually return an access_token with all the required API scope/s to access the API/s defined for the product being accessed. <br><br>OGW products have to be "atomic", if a product needs to access, let's say, an API with 5 operations with 5 different scopes. You need user consent for all of them, otherwise the product won't work if, for example, the user only gives consent for one of the scopes and not for the other 4. So Telefónica's proposal would take care of this by handling consents and legal text at the product level. OGW products can NOT work for a subset of scopes.  | For each `/authorize` call the `scope` attribute **must** be valued. in Orange proposal, this scope is valued by a concatenation of purpose+technical scope. This is straightforward for the developer to build it as: <br> - the purpose is known from the app onboarding (see previous point). One and only one purpose must be passed.  <br> - the technical scope is  defined in each CAMARA API yaml in the `security` property at path/method level. <br> Note: For one `/authorize` it is valid to ask for several technical scopes like for example `scope=FraudDetectionAndPrevention:simswap-verify-read  number-verification-verify-read`. This is a recommended pattern to limit interaction with end user. |For each /authorize call the scope attribute must be valued. The scope could be the complete list of scopes defined In Camara API yaml or a subset of those scopes. For us, it is important that this "subset of scopes" + purpose leads to a single unanimous choice of legal basis. At the time of onboarding the developer can choose mulitple scope-subsets + purpose combinations for the app. It is important that scope-subsets do not overlap. Hence these scope-subsets relevant for an API Product  are pre-configured for different pre-approved purpose options. <br> <br >This pre-configuration also allows us to determine what the legal text agreement template for an ASP who buys an API product for his App would be and also what the legal text template (which includes understandable language and not language of technical scopes) shown to the enduser would be. The developer selects and agrees to the needed combinations at the time of app-onboarding and has to use the exact same combination at the time of authorize request. Any change to this combination (less or more scopes, no scopes, different purpose) at runtime will not be accepted as a valid request and will be rejected. <br><br> Whether to append the single agreed purpose string at the beginning of the scopes or to add it as a custom claim: Here we would propose to get a feedback from OpenID colleagues so that we do not make our APIs OpenID non-compliant by making this choice on our own. Whatever is their recommendation, we are ready to follow. There are certain examples where custom claims have later become industry standards. If it is made part of the scope, we recommend appending it once only at the beginning and following the standard scope format for the rest. But as mentioned earlier, we are ready to comply to whatever is recommended by OpenID colleagues in this regard. |
| 7 | How the legal consent displayed to the end user is defined and provided? | From Telefónica's point of view, **the legal text to be shown to the user could be implemented internally by the operator as they wish**. The only requirement is that the legal text must be shown to the user before requesting access to the product, if the user's consent is required.<br><br>However, Telefónica's proposal could also make it easier to control the legal text (to be displayed to the user) that simply refers to the OGW product being accessed as a whole (legal text at product level).<br><br> One key aspect regarding this point is that end user does not know anything about scopes, APIs or these technical things; end user knows about give access to an Application which will access this information with this intention. End user will say yes or no to this, so the simplest is for the Application to send a single purpose value covering exactly that concept, which in fact matches 1-1 with the product purchased by the Developer. It's the simplest and more efficient way to join legal with technical. | Telco  associates a legal wording for each scope design-time. Then on the fly the legal notice is generated and displayed to the front end. <br> <br > As an example, simswap-verify-read technical scope is associated to wording:  'Verify latest SIM swap Date', number-verification-verify-read to 'Verify your MSIDN from network'. The request `POST /authorize` with `scope=FraudDetectionAndPrevention:simswap-verify-read` triggers following notice: <br> _"For fraud detection and prevention, application NiceApp request your consent to perform following action(s): <br> - Verify latest SIM swap Date <br> - Verify your MSIDN from network"_ | As explained in the above point, this template is already prepared as a part of creating the above-said purpose-scope-subset combinations for an API product and will be in compliance with the requirements from our legal/privacy teams (which for eg. could ask to show the text in at least 2 languages etc.) |
| 8 | What if a new API is introduced in a country? | As long as a OPGW product is already existing for this API there is nothing else to do. This OPGW product should be visible in the catalogue once Telco has a live implementation of this API | As long as a OPGW product is already existing for this API there is nothing else to do. This OPGW product should be visible in the catalogue once Telco has a live implementation of this API | Aligned with Orange |
| 9 | What if a developper wishes to use API for a purpose not defined in this country? | This would not be possible. We consider a purpose associated with a product. A developer can only use the products/purposes associated with the catalog available in that country. In order for the developer to do this, a new product would have to be defined in the catalog of that country associated with the API and purpose that the developer wants to use. So that the developer can contract this product. | Nothing to be done at OPGW product. The only action is at the authorization server to implement the legal base for this purpose for the API scope(s). | Aligned with Orange about nothing to be done to the product. <br> <br >Will depend on every individual Telco to extend their pre-approved list of purposes with the new one requested by the developer and implement the needed pre-configuration needed for purpose+scope-subset+legal-bases combinations etc. |
| 10| Auth Server required considerations.<li>Information required to be defined and stored in Auth Server.<li>Auth Server acccess policies. | <li>Information required to be defined and stored in Auth Server.<ul><li>OGW product/s to which a developer has access. Basically those that had to be onboarded for that developer on the operator side using the corresponding Operate APIs outside the scope of CAMARA.<li>OGW product/s information<ul><li>purpose associated to the product.<li>legal basis associated to the purpose according to the country regulation.<li>API/s associated to the product i.e. API/s scope/s defined in API OpenAPI specification/s accessible for the product requested.</ul>Essentially all the information required for the Auth Server to apply the necessary policies and logic for accessing OGW products.</ul><br><li>**Each operator can implement this configuration internally on the Auth server side as they wish. As far as access from third party applications is concerned, they only have to worry about requesting access to the standardised OGW product scope**. | The authorization server will receive a ``scope`` valued with a purpose and 'yaml-defined' technical scope that describe the data claim(s). The AS will be configured to trigger adequate lgal base process accordingly to this combination. Our proposal did not trigger any specific on Athirization Server pattern. |  |
| 11 | Resource Server required considerations.<li>Information required to be defined and stored in Resource Server.<li>API specification scopes definition. | The standard openAPI specifications of the CAMARA APIs (.yaml file) remain the same no matter which product/purpose is defined or updated during the product lifecycle. The definition of OGW products (and purposes) is decoupled from the API specifications. Technical scopes remain the same. | Same than Telefonica - No impact on the yaml|  |











