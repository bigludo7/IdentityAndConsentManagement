


# Purpose, API & open Gateway product granularity

## Objectives of this document

A lot of discussion around the concept of purpose and its management in CAMARA API occurred in particular in the Issue#32 (https://github.com/camaraproject/IdentityAndConsentManagement/issues/32).

We have, as of now, 2 distinct proposal on the table: one initially provided by Telefonica, and then a second proposed by the Orange team. Both proposal have a lot of common & agreed on the strong requirement for purpose & consent management. But as both proposal diverge on the Open Gateway product whom frame the API commercialization, the following table sum-up main points of both proposal in a form of a FAQ.

## Proposal presentation


| Topic     | Telefonica proposal | Orange proposal |DT proposal |
| --------- | ------------------- | --------------- |---------------|
| What is the Open Gateway (OPGW) Product granularity? |  |  Open Gateway product matches 1-1 with a CAMARA API. For example, as of now, the CAMARA Device location API family features 2 APIs (2 yaml): `location-retrieval` and `location_verification` : we consider them as 2 separate OPGW product. The OPGW product covers completely the API (all the resources of the API). This is an important point because it means that API granularity must not be considered only from a technical aspect but also from a business aspect (which is already the case for CAMARA API). <br> The OPGW product is **not** strong-coupled with a purpose but independent of it. However in the catalog it is possible to recommend OPGW product with purpose (see next point).|Aligned with Orange |
| Do link between OPGW product and purpose is visible in Telco Catalog? |  |  In the catalog, it could be possible to browse OPGW product per category. Several categories could be created, as such 'purpose' could be defined as a category, and purpose  value could be defined as category value (in order to get for example OPGW Product related to Fraud prevention & detection) but this is only informative information.  | Aligned with Orange |
| What are country market required agreement before to launch?|   | Telco must agree on the OPGW product to be launched in the country as a minimum 'critical mass' must be available. Additionally Telco must indicate for each API scope the legal base associated with purposes for this country.| Not sure if this question is relevant for the purpose discussion |
| What is expected during Application onboarding?|   | When a developer wishes to uses CAMARA API, developer first onboards an application. Mandatory information to onboard an application is to provide the purpose (or the list of purposes) associated with this application. |Aligned with Orange regarding purpose selection at the time of Applicaton onboarding. Some other steps are also present here which are elaborated in the next row |
| What is expected during API onboarding?|   | When a developer wishes to use a CAMARA API (prequisite developer has onboarded an app - previous point), it has to contractually agrees with the Hyperscaler/agregator/telco about Open Gateway product purchase. There is not tight coupling with purpose at this stage. Of course in the catalog the Telco could recommend some API for some purpose but API (and associated Open Gateway product) and purpose are not associated.  |We do not have this separate API onboarding stage. The agreement we want to have with the ASP is always for a specific App. We do not intend to have a generic agreement with an ASP which covers all his apps and our certain API product/s. In our agreement with the ASP we intend to have which ASP uses which API product(with agreed scopes) in which APP and for what purpose. So though API-product and purpose are not tightly coupled, the coupling is made at the time of app onboarding. |
| What is expected for each `/authorize` call? |   | For each `/authorize` call the `scope` attribute **must** be valued. in Orange proposal, this scope is valued by a concatenation of purpose+technical scope. This is straightforward for the developer to build it as: <br> - the purpose is known from the app onboarding (see previous point). One and only one purpose must be passed.  <br> - the technical scope is  defined in each CAMARA API yaml in the `security` property at path/method level. <br> Note: For one `/authorize` it is valid to ask for several technical scopes like for example `scope=FraudDetectionAndPrevention:simswap-verify-read  number-verification-verify-read`. This is a recommended pattern to limit interaction with end user. |For each /authorize call the scope attribute must be valued. The scope could be the complete list of scopes defined In Camara API yaml or a subset of those scopes. For us, it is important that this "subset of scopes" + purpose leads to a single unanimous choice of legal basis. At the time of onboarding the developer can choose mulitple scope-subsets + purpose combinations for the app. It is important that scope-subsets do not overlap. Hence these scope-subsets relevant for an API Product  are pre-configured for different pre-approved purpose options. <br> <br >This pre-configuration also allows us to determine what the legal text agreement template for an ASP who buys an API product for his App would be and also what the legal text template (which includes understandable language and not language of technical scopes) shown to the enduser would be. The developer selects and agrees to the needed combinations at the time of app-onboarding and has to use the exact same combination at the time of authorize request. Any change to this combination (less or more scopes, no scopes, different purpose) at runtime will not be accepted as a valid request and will be rejected. <br><br> Whether to append the single agreed purpose string at the beginning of the scopes or to add it as a custom claim: Here we would propose to get a feedback from OpenID colleagues so that we do not make our APIs OpenID non-compliant by making this choice on our own. Whatever is their recommendation, we are ready to follow. There are certain examples where custom claims have later become industry standards. If it is made part of the scope, we recommend appending it once only at the beginning and following the standard scope format for the rest. But as mentioned earlier, we are ready to comply to whatever is recommended by OpenID colleagues in this regard. |
| How the legal consent displayed to the end user is defined and provided? | | Telco  associates a legal wording for each scope design-time. Then on the fly the legal notice is generated and displayed to the front end. <br> <br > As an example, simswap-verify-read technical scope is associated to wording:  'Verify latest SIM swap Date', number-verification-verify-read to 'Verify your MSIDN from network'. The request `POST /authorize` with `scope=FraudDetectionAndPrevention:simswap-verify-read` triggers following notice: <br> _"For fraud detection and prevention, application NiceApp request your consent to perform following action(s): <br> - Verify latest SIM swap Date <br> - Verify your MSIDN from network"_ | As explained in the above point, this template is already prepared as a part of creating the above-said purpose-scope-subset combinations for an API product and will be in compliance with the requirements from our legal/privacy teams (which for eg. could ask to show the text in at least 2 languages etc.) |
| What if a new API is introduced in a country? |  | As long as a OPGW product is already existing for this API there is nothing else to do. This OPGW product should be visible in the catalogue once Telco has a live implementation of this API | Aligned with Orange |
| What if a developper wishes to use API for a purpose not defined in this country? |  | Nothing to be done at OPGW product. The only action is at the authorization server to implement the legal base for this purpose for the API scope(s). | Aligned with Orange about nothing to be done to the product. <br> <br >Will depend on every individual Telco to extend their pre-approved list of purposes with the new one requested by the developer and implement the needed pre-configuration needed for purpose+scope-subset+legal-bases combinations etc. |













